parseRepo:
  handler: src/parser.handler
  events:
    - http:
        path: /parser/{version}/{username}/{repo}
        method: get
    - http:
        path: /parser/{version}/{username}/{repo}/{branch}
        method: get

# COGS
getAllCogs:
  handler: src/cogs.get
  events:
    - http:
        path: /cogs
        method: get
getCog:
  handler: src/cogs.getOne
  events:
    - http:
        path: /cogs/{username}/{repo}/{branch}/{cog}
        method: get
getCogsInRepo:
  handler: src/cogs.getCogsInRepo
  events:
    - http:
        path: /cogs/{username}/{repo}
        method: get
    - http:
        path: /cogs/{username}/{repo}/{branch}
        method: get
getCogsForUser:
  handler: src/cogs.getCogsForUser
  events:
    - http:
        path: /cogs/{username}
        method: get

# REPOS
getAllRepos:
  handler: src/repos.get
  events:
    - http:
        path: /repos
        method: get
getRepo:
  handler: src/repos.getOne
  events:
    - http:
        path: /repos/{username}/{repo}
        method: get
    - http:
        path: /repos/{username}/{repo}/{branch}
        method: get
getReposForUser:
  handler: src/repos.getReposForUser
  events:
    - http:
        path: /repos/{username}
        method: get

# V1 Sync
syncCogs:
  handler: src/sync.cogs
  events:
    # - schedule:
    #     rate: rate(1 days)
    #     enabled: true
    - http:
        path: /sync/cogs
        method: get
syncRepos:
  handler: src/sync.repos
  events:
    # - schedule:
    #     rate: rate(1 days)
    #     enabled: true
    - http:
        path: /sync/repos
        method: get

# Auth
auth:
  handler: src/auth.authorize
  cors: true
  environment:
    AUTH0_CLIENT_PUBLIC_KEY: ${file(./public_key)}
    AUTH0_CLIENT_ID: ${env:AUTH0_CLIENT_ID}
sm:
  handler: src/sm.handler
  environment:
    AUTH0_API_CLIENT_ID: ${env:AUTH0_API_CLIENT_ID}
    AUTH0_API_CLIENT_SECRET: ${env:AUTH0_API_CLIENT_SECRET}

# Github
getGithubHooks:
  handler: src/github.getGithubHooks
  events:
    - http:
        path: /github/hooks/{username}/{repo}
        method: get
createGithubHook:
  handler: src/github.createGithubHook
  events:
    - http:
        path: /github/hooks
        method: post
        authorizer: auth
        cors: true
getGithubReposForUser:
  handler: src/github.getRepos
  events:
    - http:
        path: /github/repos/{username}
        method: get
        authorizer: auth
        cors: true
getGithubBranchesForRepo:
  handler: src/github.getBranches
  events:
    - http:
        path: /github/branches/{username}/{repo}
        method: get
        authorizer: auth
        cors: true
hookTest:
  handler: src/github.hookTest
  events:
    - http:
        path: /hookTest/{username}/{repo}/{branch}
        method: post
